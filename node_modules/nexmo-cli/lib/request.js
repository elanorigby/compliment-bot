'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _readline = require('readline');

var _readline2 = _interopRequireDefault(_readline);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Request = function () {
  function Request(config, client, response) {
    _classCallCheck(this, Request);

    this.config = config;
    this.client = client;
    this.response = response;
  }
  // Account

  _createClass(Request, [{
    key: 'accountSetup',
    value: function accountSetup(key, secret, flags) {
      this._verifyCredentials(key, secret, this.response.accountSetup(this.config, key, secret, flags).bind(this.response));
    }
  }, {
    key: '_verifyCredentials',
    value: function _verifyCredentials(key, secret, callback) {
      var client = this.client.instanceWith(key, secret);
      client.account.checkBalance(callback);
    }
  }, {
    key: 'accountInfo',
    value: function accountInfo() {
      this.response.accountInfo(this.client.instance());
    }
  }, {
    key: 'accountBalance',
    value: function accountBalance() {
      this.client.instance().account.checkBalance(this.response.accountBalance.bind(this.response));
    }

    // Pricing

  }, {
    key: 'priceSms',
    value: function priceSms(number) {
      number = stripPlus(number);
      this.client.instance().number.getPhonePricing('sms', number, this.response.priceSms.bind(this.response));
    }
  }, {
    key: 'priceVoice',
    value: function priceVoice(number) {
      number = stripPlus(number);
      this.client.instance().number.getPhonePricing('voice', number, this.response.priceVoice.bind(this.response));
    }
  }, {
    key: 'priceCountry',
    value: function priceCountry(country_code) {
      this.client.instance().number.getPricing(country_code, this.response.priceCountry.bind(this.response));
    }

    // Numbers

  }, {
    key: 'numbersList',
    value: function numbersList(flags) {
      var options = { size: 100 };
      if (flags.page) {
        options.index = flags.page;
      }
      if (flags.size) {
        options.size = flags.size;
      }

      if (flags.pattern) {
        options.pattern = flags.pattern;
        options.search_pattern = 1;
        if (options.pattern[0] === '*') options.search_pattern = 2;
        if (options.pattern.slice(-1) === '*') options.search_pattern = 0;
      }

      this.client.instance().number.get(options, this.response.numbersList(flags).bind(this.response));
    }
  }, {
    key: 'numberSearch',
    value: function numberSearch(country_code, flags) {
      country_code = country_code.toUpperCase();

      var options = { features: [], size: 100 };
      if (flags.voice) {
        options.features.push('VOICE');
      }
      if (flags.sms) {
        options.features.push('SMS');
      }
      if (flags.page) {
        options.index = flags.page;
      }
      if (flags.size) {
        options.size = flags.size;
      }

      if (flags.pattern) {
        options.pattern = flags.pattern;
        options.search_pattern = 1;
        if (options.pattern[0] === '*') options.search_pattern = 2;
        if (options.pattern.slice(-1) === '*') options.search_pattern = 0;
      }

      this.client.instance().number.search(country_code, options, this.response.numberSearch(flags).bind(this.response));
    }
  }, {
    key: 'numberBuy',
    value: function numberBuy(numberOrPattern, command) {
      if (command.country_code) {
        this.numberBuyFromSearch(command.country_code, numberOrPattern, command);
      } else {
        this.numberBuyFromNumber(numberOrPattern, command);
      }
    }
  }, {
    key: 'numberBuyFromNumber',
    value: function numberBuyFromNumber(number, flags) {
      var _this = this;

      number = stripPlus(number);
      confirm('Buying ' + number + '. This operation will charge your account.', this.response.emitter, flags, function () {
        _this.getCountryCode(number, flags, function (country_code) {
          _this.client.instance().number.buy(country_code, number, _this.response.numberBuyFromNumber(number).bind(_this.response));
        });
      });
    }
  }, {
    key: 'numberBuyFromSearch',
    value: function numberBuyFromSearch(country_code, pattern, flags) {
      var _this2 = this;

      var options = { features: ['VOICE'] };

      if (pattern) {
        options.pattern = pattern;
        options.search_pattern = 1;
        if (pattern[0] === '*') options.search_pattern = 2;
        if (pattern.slice(-1) === '*') options.search_pattern = 0;
      }

      this.client.instance().number.search(country_code, options, this.response.numberBuyFromPattern(function (number) {
        _this2.numberBuyFromNumber(number, flags);
      }));
    }
  }, {
    key: 'numberCancel',
    value: function numberCancel(number, flags) {
      var _this3 = this;

      confirm('This operation can not be reversed.', this.response.emitter, flags, function () {
        _this3.getCountryCode(number, flags, function (country_code) {
          _this3.client.instance().number.cancel(country_code, number, _this3.response.numberCancel(number).bind(_this3.response));
        });
      });
    }

    // Applications

  }, {
    key: 'applicationsList',
    value: function applicationsList(flags) {
      var options = { page_size: 100 };
      if (flags.page) {
        options.index = flags.page;
      }
      if (flags.size) {
        options.page_size = flags.size;
      }

      this.client.instance().app.get(options, this.response.applicationsList(flags).bind(this.response));
    }
  }, {
    key: 'applicationCreate',
    value: function applicationCreate(name, answer_url, event_url, flags) {
      var options = {};
      if (flags.answer_method) {
        options.answer_method = flags.answer_method;
      }
      if (flags.event_method) {
        options.event_method = flags.event_method;
      }

      this.client.instance().app.create(name, flags.type, answer_url, event_url, options, this.response.applicationCreate(flags));
    }
  }, {
    key: 'applicationShow',
    value: function applicationShow(app_id) {
      this.client.instance().app.get(app_id, this.response.applicationShow.bind(this.response));
    }
  }, {
    key: 'applicationUpdate',
    value: function applicationUpdate(app_id, name, answer_url, event_url, flags) {
      var options = {};
      if (flags.answer_method) {
        options.answer_method = flags.answer_method;
      }
      if (flags.event_method) {
        options.event_method = flags.event_method;
      }

      this.client.instance().app.update(app_id, name, flags.type, answer_url, event_url, options, this.response.applicationUpdate.bind(this.response));
    }
  }, {
    key: 'applicationDelete',
    value: function applicationDelete(app_id, flags) {
      var _this4 = this;

      return confirm('This operation can not be reversed.', this.response.emitter, flags, function () {
        _this4.client.instance().app.delete(app_id, _this4.response.applicationDelete.bind(_this4.response));
      });
    }
  }, {
    key: 'applicationNumbers',
    value: function applicationNumbers(app_id, flags) {
      var options = {};
      if (flags.page) {
        options.index = flags.page;
      }
      if (flags.size) {
        options.size = flags.size;
      }

      this.client.instance().number.get(options, this.response.applicationNumbers(app_id, flags).bind(this.response));
    }

    // links

  }, {
    key: 'linkApp',
    value: function linkApp(number, app_id, flags) {
      this._link(number, flags, null, 'app', app_id);
    }
  }, {
    key: 'linkSms',
    value: function linkSms(number, callback_url, flags) {
      this._link(number, flags, callback_url, 'sms', null);
    }
  }, {
    key: 'linkTel',
    value: function linkTel(number, other_number, flags) {
      this._link(number, flags, null, 'tel', other_number, flags.voice_status_callback);
    }
  }, {
    key: 'linkSip',
    value: function linkSip(number, sip_uri, flags) {
      this._link(number, flags, null, 'sip', sip_uri, flags.voice_status_callback);
    }
  }, {
    key: 'linkVxml',
    value: function linkVxml(number, calback_url, flags) {
      this._link(number, flags, null, 'vxml', calback_url, flags.voice_status_callback);
    }
  }, {
    key: 'unlinkApp',
    value: function unlinkApp(number, flags) {
      this._link(number, flags, null, 'app');
    }
  }, {
    key: 'unlinkSms',
    value: function unlinkSms(number, flags) {
      this._link(number, flags, '', 'sms');
    }
  }, {
    key: 'unlinkTel',
    value: function unlinkTel(number, flags) {
      this._link(number, flags, null, 'tel');
    }
  }, {
    key: 'unlinkSip',
    value: function unlinkSip(number, flags) {
      this._link(number, flags, null, 'sip');
    }
  }, {
    key: 'unlinkVxml',
    value: function unlinkVxml(number, flags) {
      this._link(number, flags, null, 'vxml');
    }
  }, {
    key: 'numberUpdate',
    value: function numberUpdate(number, flags) {
      var _this5 = this;

      number = stripPlus(number);
      this.getCountryCode(number, flags, function (country_code) {
        var options = {};
        if (flags.mo_http_url) options.moHttpUrl = flags.mo_http_url;
        if (flags.voice_callback_type) options.voiceCallbackType = flags.voice_callback_type;
        if (flags.voice_callback_value) options.voiceCallbackValue = flags.voice_callback_value;
        if (flags.voice_status_callback) options.voiceStatusCallback = flags.voice_status_callback;
        _this5.client.instance().number.update(country_code, number, options, _this5.response.numberUpdate.bind(_this5.response));
      });
    }
  }, {
    key: '_link',
    value: function _link(number, flags, mo_http_url, voice_callback_type, voice_callback_value, voice_status_callback) {
      var _this6 = this;

      if (flags == null) {
        flags = {};
      }
      number = stripPlus(number);
      this.getCountryCode(number, flags, function (country_code) {
        var options = {};

        if (voice_callback_type == 'sms') {
          options.moHttpUrl = mo_http_url;
        } else {
          options.voiceCallbackType = voice_callback_type;
          if (voice_callback_value) options.voiceCallbackValue = voice_callback_value;
          if (voice_status_callback) options.voiceStatusCallback = voice_status_callback;
        }

        _this6.client.instance().number.update(country_code, number, options, _this6.response.numberUpdate.bind(_this6.response));
      });
    }

    // Insight

  }, {
    key: 'insightBasic',
    value: function insightBasic(number) {
      number = stripPlus(number);
      this.client.instance().numberInsight.get({ level: 'basic', number: number }, this.response.insightBasic.bind(this.response));
    }
  }, {
    key: 'insightStandard',
    value: function insightStandard(number, flags) {
      var _this7 = this;

      number = stripPlus(number);
      confirm('This operation will charge your account.', this.response.emitter, flags, function () {
        _this7.client.instance().numberInsight.get({ level: 'standard', number: number }, _this7.response.insightStandard.bind(_this7.response));
      });
    }
  }, {
    key: 'insightAdvanced',
    value: function insightAdvanced(number, flags) {
      var _this8 = this;

      number = stripPlus(number);
      confirm('This operation will charge your account.', this.response.emitter, flags, function () {
        _this8.client.instance().numberInsight.get({ level: 'advancedSync', number: number }, _this8.response.insightStandard.bind(_this8.response));
      });
    }

    // sending messages

  }, {
    key: 'sendSms',
    value: function sendSms(to, text, flags) {
      var _this9 = this;

      confirm('This operation will charge your account.', this.response.emitter, flags, function () {
        _this9.client.instance().message.sendSms(flags.from, to, text.join(' '), _this9.response.sendSms.bind(_this9.response));
      });
    }
  }, {
    key: 'generateJwt',
    value: function generateJwt(privateKey, claims, flags) {
      var token = null;
      var error = null;

      try {
        var fullClaims = {};
        if (flags.app_id) {
          fullClaims['application_id'] = flags.app_id;
        }

        claims.forEach(function (claim) {
          var nameValue = claim.split('=');
          if (nameValue.length !== 2) {
            throw new Error('All claims must be in the form `name=value`. Got: ' + nameValue);
          }
          // Using JSON.parse to cast 'exp' to number
          if (nameValue[0] === 'acl' || nameValue[0] === 'exp') {
            try {
              fullClaims[nameValue[0]] = JSON.parse(nameValue[1]);
            } catch (e) {
              fullClaims[nameValue[0]] = nameValue[1];
            }
          } else {
            fullClaims[nameValue[0]] = nameValue[1];
          }
        });

        token = this.client.definition().generateJwt(privateKey, fullClaims);
      } catch (ex) {
        error = ex;
      }
      this.response.generateJwt(error, token);
    }
  }, {
    key: 'getCountryCode',
    value: function getCountryCode(number, flags, callback) {
      if (flags.country_code) {
        callback(flags.country_code);
      } else {
        this.client.instance().numberInsight.get({ level: 'basic', number: number }, this.response.numberInsight(function (response) {
          callback(response.country_code);
        }));
      }
    }
  }]);

  return Request;
}();

exports.default = Request;

// private methods

var confirm = function confirm(message, emitter, flags, callback) {
  if (flags.confirm) {
    callback();
  } else {
    var cli = _readline2.default.createInterface(process.stdin, process.stdout);
    cli.question(message + '\n\nPlease type "confirm" to continue: ', function (answer) {
      if (answer.toString().trim() == 'confirm') {
        emitter.log(' ');
        callback();
      } else {
        process.exit(1);
      }

      cli.close();
      process.stdin.destroy();
    });
  }
};

var stripPlus = function stripPlus(number) {
  if (!number) {
    return number;
  }
  while (number.charAt(0) === '+') {
    number = number.substr(1);
  }
  return number;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXF1ZXN0LmpzIl0sIm5hbWVzIjpbIlJlcXVlc3QiLCJjb25maWciLCJjbGllbnQiLCJyZXNwb25zZSIsImtleSIsInNlY3JldCIsImZsYWdzIiwiX3ZlcmlmeUNyZWRlbnRpYWxzIiwiYWNjb3VudFNldHVwIiwiYmluZCIsImNhbGxiYWNrIiwiaW5zdGFuY2VXaXRoIiwiYWNjb3VudCIsImNoZWNrQmFsYW5jZSIsImFjY291bnRJbmZvIiwiaW5zdGFuY2UiLCJhY2NvdW50QmFsYW5jZSIsIm51bWJlciIsInN0cmlwUGx1cyIsImdldFBob25lUHJpY2luZyIsInByaWNlU21zIiwicHJpY2VWb2ljZSIsImNvdW50cnlfY29kZSIsImdldFByaWNpbmciLCJwcmljZUNvdW50cnkiLCJvcHRpb25zIiwic2l6ZSIsInBhZ2UiLCJpbmRleCIsInBhdHRlcm4iLCJzZWFyY2hfcGF0dGVybiIsInNsaWNlIiwiZ2V0IiwibnVtYmVyc0xpc3QiLCJ0b1VwcGVyQ2FzZSIsImZlYXR1cmVzIiwidm9pY2UiLCJwdXNoIiwic21zIiwic2VhcmNoIiwibnVtYmVyU2VhcmNoIiwibnVtYmVyT3JQYXR0ZXJuIiwiY29tbWFuZCIsIm51bWJlckJ1eUZyb21TZWFyY2giLCJudW1iZXJCdXlGcm9tTnVtYmVyIiwiY29uZmlybSIsImVtaXR0ZXIiLCJnZXRDb3VudHJ5Q29kZSIsImJ1eSIsIm51bWJlckJ1eUZyb21QYXR0ZXJuIiwiY2FuY2VsIiwibnVtYmVyQ2FuY2VsIiwicGFnZV9zaXplIiwiYXBwIiwiYXBwbGljYXRpb25zTGlzdCIsIm5hbWUiLCJhbnN3ZXJfdXJsIiwiZXZlbnRfdXJsIiwiYW5zd2VyX21ldGhvZCIsImV2ZW50X21ldGhvZCIsImNyZWF0ZSIsInR5cGUiLCJhcHBsaWNhdGlvbkNyZWF0ZSIsImFwcF9pZCIsImFwcGxpY2F0aW9uU2hvdyIsInVwZGF0ZSIsImFwcGxpY2F0aW9uVXBkYXRlIiwiZGVsZXRlIiwiYXBwbGljYXRpb25EZWxldGUiLCJhcHBsaWNhdGlvbk51bWJlcnMiLCJfbGluayIsImNhbGxiYWNrX3VybCIsIm90aGVyX251bWJlciIsInZvaWNlX3N0YXR1c19jYWxsYmFjayIsInNpcF91cmkiLCJjYWxiYWNrX3VybCIsIm1vX2h0dHBfdXJsIiwibW9IdHRwVXJsIiwidm9pY2VfY2FsbGJhY2tfdHlwZSIsInZvaWNlQ2FsbGJhY2tUeXBlIiwidm9pY2VfY2FsbGJhY2tfdmFsdWUiLCJ2b2ljZUNhbGxiYWNrVmFsdWUiLCJ2b2ljZVN0YXR1c0NhbGxiYWNrIiwibnVtYmVyVXBkYXRlIiwibnVtYmVySW5zaWdodCIsImxldmVsIiwiaW5zaWdodEJhc2ljIiwiaW5zaWdodFN0YW5kYXJkIiwidG8iLCJ0ZXh0IiwibWVzc2FnZSIsInNlbmRTbXMiLCJmcm9tIiwiam9pbiIsInByaXZhdGVLZXkiLCJjbGFpbXMiLCJ0b2tlbiIsImVycm9yIiwiZnVsbENsYWltcyIsImZvckVhY2giLCJjbGFpbSIsIm5hbWVWYWx1ZSIsInNwbGl0IiwibGVuZ3RoIiwiRXJyb3IiLCJKU09OIiwicGFyc2UiLCJlIiwiZGVmaW5pdGlvbiIsImdlbmVyYXRlSnd0IiwiZXgiLCJjbGkiLCJyZWFkbGluZSIsImNyZWF0ZUludGVyZmFjZSIsInByb2Nlc3MiLCJzdGRpbiIsInN0ZG91dCIsInF1ZXN0aW9uIiwiYW5zd2VyIiwidG9TdHJpbmciLCJ0cmltIiwibG9nIiwiZXhpdCIsImNsb3NlIiwiZGVzdHJveSIsImNoYXJBdCIsInN1YnN0ciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7SUFFTUEsTztBQUNKLG1CQUFZQyxNQUFaLEVBQW9CQyxNQUFwQixFQUE0QkMsUUFBNUIsRUFBc0M7QUFBQTs7QUFDcEMsU0FBS0YsTUFBTCxHQUFjQSxNQUFkO0FBQ0EsU0FBS0MsTUFBTCxHQUFjQSxNQUFkO0FBQ0EsU0FBS0MsUUFBTCxHQUFnQkEsUUFBaEI7QUFDRDtBQUNEOzs7O2lDQUVhQyxHLEVBQUtDLE0sRUFBUUMsSyxFQUFPO0FBQy9CLFdBQUtDLGtC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QWNpRixhQUFkLENBQTRCLFVBQUNqRixRQUFELEVBQWM7QUFDckhPLG1CQUFTUCxTQUFTbUIsWUFBbEI7QUFDRCxTQUY0RSxDQUE3RTtBQUdEO0FBQ0Y7Ozs7OztrQkFHWXRCLE87O0FBRWY7O0FBRUEsSUFBSTZDLFVBQVUsU0FBVkEsT0FBVSxDQUFVNkMsT0FBVixFQUFtQjVDLE9BQW5CLEVBQTRCeEMsS0FBNUIsRUFBbUNJLFFBQW5DLEVBQTZDO0FBQ3pELE1BQUlKLE1BQU11QyxPQUFWLEVBQW1CO0FBQ2pCbkM7QUFDRCxHQUZELE1BRU87QUFDTCxRQUFJcUcsTUFBTUMsbUJBQVNDLGVBQVQsQ0FBeUJDLFFBQVFDLEtBQWpDLEVBQXdDRCxRQUFRRSxNQUFoRCxDQUFWO0FBQ0FMLFFBQUlNLFFBQUosQ0FBYTNCLFVBQVUseUNBQXZCLEVBQWtFLFVBQUM0QixNQUFELEVBQVk7QUFDNUUsVUFBSUEsT0FBT0MsUUFBUCxHQUFrQkMsSUFBbEIsTUFBNEIsU0FBaEMsRUFBMkM7QUFDekMxRSxnQkFBUTJFLEdBQVIsQ0FBWSxHQUFaO0FBQ0EvRztBQUNELE9BSEQsTUFHTztBQUNMd0csZ0JBQVFRLElBQVIsQ0FBYSxDQUFiO0FBQ0Q7O0FBRURYLFVBQUlZLEtBQUo7QUFDQVQsY0FBUUMsS0FBUixDQUFjUyxPQUFkO0FBQ0QsS0FWRDtBQVdEO0FBQ0YsQ0FqQkQ7O0FBbUJBLElBQUkxRyxZQUFZLFNBQVpBLFNBQVksQ0FBVUQsTUFBVixFQUFrQjtBQUNoQyxNQUFJLENBQUNBLE1BQUwsRUFBYTtBQUFFLFdBQU9BLE1BQVA7QUFBZ0I7QUFDL0IsU0FBT0EsT0FBTzRHLE1BQVAsQ0FBYyxDQUFkLE1BQXFCLEdBQTVCLEVBQWlDO0FBQy9CNUcsYUFBU0EsT0FBTzZHLE1BQVAsQ0FBYyxDQUFkLENBQVQ7QUFDRDtBQUNELFNBQU83RyxNQUFQO0FBQ0QsQ0FORCIsImZpbGUiOiJyZXF1ZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHJlYWRsaW5lIGZyb20gJ3JlYWRsaW5lJztcblxuY2xhc3MgUmVxdWVzdCB7XG4gIGNvbnN0cnVjdG9yKGNvbmZpZywgY2xpZW50LCByZXNwb25zZSkge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuY2xpZW50ID0gY2xpZW50O1xuICAgIHRoaXMucmVzcG9uc2UgPSByZXNwb25zZTtcbiAgfVxuICAvLyBBY2NvdW50XG5cbiAgYWNjb3VudFNldHVwKGtleSwgc2VjcmV0LCBmbGFncykge1xuICAgIHRoaXMuX3ZlcmlmeUNyZWRlbnRpYWxzKGtleSwgc2VjcmV0LCB0aGlzLnJlc3BvbnNlLmFjY291bnRTZXR1cCh0aGlzLmNvbmZpZywga2V5LCBzZWNyZXQsIGZsYWdzKS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIF92ZXJpZnlDcmVkZW50aWFscyhrZXksIHNlY3JldCwgY2FsbGJhY2spIHtcbiAgICBsZXQgY2xpZW50ID0gdGhpcy5jbGllbnQuaW5zdGFuY2VXaXRoKGtleSwgc2VjcmV0KTtcbiAgICBjbGllbnQuYWNjb3VudC5jaGVja0JhbGFuY2UoY2FsbGJhY2spO1xuICB9XG5cbiAgYWNjb3VudEluZm8oKSB7XG4gICAgdGhpcy5yZXNwb25zZS5hY2NvdW50SW5mbyh0aGlzLmNsaWVudC5pbnN0YW5jZSgpKTtcbiAgfVxuXG4gIGFjY291bnRCYWxhbmNlKCkge1xuICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkuYWNjb3VudC5jaGVja0JhbGFuY2UodGhpcy5yZXNwb25zZS5hY2NvdW50QmFsYW5jZS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIC8vIFByaWNpbmdcblxuICBwcmljZVNtcyhudW1iZXIpIHtcbiAgICBudW1iZXIgPSBzdHJpcFBsdXMobnVtYmVyKTtcbiAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLm51bWJlci5nZXRQaG9uZVByaWNpbmcoJ3NtcycsIG51bWJlciwgdGhpcy5yZXNwb25zZS5wcmljZVNtcy5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIHByaWNlVm9pY2UobnVtYmVyKSB7XG4gICAgbnVtYmVyID0gc3RyaXBQbHVzKG51bWJlcik7XG4gICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5udW1iZXIuZ2V0UGhvbmVQcmljaW5nKCd2b2ljZScsIG51bWJlciwgdGhpcy5yZXNwb25zZS5wcmljZVZvaWNlLmJpbmQodGhpcy5yZXNwb25zZSkpO1xuICB9XG5cbiAgcHJpY2VDb3VudHJ5KGNvdW50cnlfY29kZSkge1xuICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkubnVtYmVyLmdldFByaWNpbmcoY291bnRyeV9jb2RlLCB0aGlzLnJlc3BvbnNlLnByaWNlQ291bnRyeS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIC8vIE51bWJlcnNcblxuICBudW1iZXJzTGlzdChmbGFncykge1xuICAgIGxldCBvcHRpb25zID0geyBzaXplOiAxMDAgfTtcbiAgICBpZiAoZmxhZ3MucGFnZSkgeyBvcHRpb25zLmluZGV4ID0gZmxhZ3MucGFnZTsgfVxuICAgIGlmIChmbGFncy5zaXplKSB7IG9wdGlvbnMuc2l6ZSA9IGZsYWdzLnNpemU7IH1cblxuICAgIGlmIChmbGFncy5wYXR0ZXJuKSB7XG4gICAgICBvcHRpb25zLnBhdHRlcm4gPSBmbGFncy5wYXR0ZXJuO1xuICAgICAgb3B0aW9ucy5zZWFyY2hfcGF0dGVybiA9IDE7XG4gICAgICBpZiAob3B0aW9ucy5wYXR0ZXJuWzBdID09PSAnKicpIG9wdGlvbnMuc2VhcmNoX3BhdHRlcm4gPSAyO1xuICAgICAgaWYgKG9wdGlvbnMucGF0dGVybi5zbGljZSgtMSkgPT09ICcqJykgb3B0aW9ucy5zZWFyY2hfcGF0dGVybiA9IDA7XG4gICAgfVxuXG4gICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5udW1iZXIuZ2V0KG9wdGlvbnMsIHRoaXMucmVzcG9uc2UubnVtYmVyc0xpc3QoZmxhZ3MpLmJpbmQodGhpcy5yZXNwb25zZSkpO1xuICB9XG5cbiAgbnVtYmVyU2VhcmNoKGNvdW50cnlfY29kZSwgZmxhZ3MpIHtcbiAgICBjb3VudHJ5X2NvZGUgPSBjb3VudHJ5X2NvZGUudG9VcHBlckNhc2UoKTtcblxuICAgIGxldCBvcHRpb25zID0geyBmZWF0dXJlczogW10sIHNpemU6IDEwMCB9O1xuICAgIGlmIChmbGFncy52b2ljZSkgeyBvcHRpb25zLmZlYXR1cmVzLnB1c2goJ1ZPSUNFJyk7IH1cbiAgICBpZiAoZmxhZ3Muc21zKSB7IG9wdGlvbnMuZmVhdHVyZXMucHVzaCgnU01TJyk7IH1cbiAgICBpZiAoZmxhZ3MucGFnZSkgeyBvcHRpb25zLmluZGV4ID0gZmxhZ3MucGFnZTsgfVxuICAgIGlmIChmbGFncy5zaXplKSB7IG9wdGlvbnMuc2l6ZSA9IGZsYWdzLnNpemU7IH1cblxuICAgIGlmIChmbGFncy5wYXR0ZXJuKSB7XG4gICAgICBvcHRpb25zLnBhdHRlcm4gPSBmbGFncy5wYXR0ZXJuO1xuICAgICAgb3B0aW9ucy5zZWFyY2hfcGF0dGVybiA9IDE7XG4gICAgICBpZiAob3B0aW9ucy5wYXR0ZXJuWzBdID09PSAnKicpIG9wdGlvbnMuc2VhcmNoX3BhdHRlcm4gPSAyO1xuICAgICAgaWYgKG9wdGlvbnMucGF0dGVybi5zbGljZSgtMSkgPT09ICcqJykgb3B0aW9ucy5zZWFyY2hfcGF0dGVybiA9IDA7XG4gICAgfVxuXG4gICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5udW1iZXIuc2VhcmNoKGNvdW50cnlfY29kZSwgb3B0aW9ucywgdGhpcy5yZXNwb25zZS5udW1iZXJTZWFyY2goZmxhZ3MpLmJpbmQodGhpcy5yZXNwb25zZSkpO1xuICB9XG5cbiAgbnVtYmVyQnV5KG51bWJlck9yUGF0dGVybiwgY29tbWFuZCkge1xuICAgIGlmIChjb21tYW5kLmNvdW50cnlfY29kZSkge1xuICAgICAgdGhpcy5udW1iZXJCdXlGcm9tU2VhcmNoKGNvbW1hbmQuY291bnRyeV9jb2RlLCBudW1iZXJPclBhdHRlcm4sIGNvbW1hbmQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMubnVtYmVyQnV5RnJvbU51bWJlcihudW1iZXJPclBhdHRlcm4sIGNvbW1hbmQpO1xuICAgIH1cbiAgfVxuXG4gIG51bWJlckJ1eUZyb21OdW1iZXIobnVtYmVyLCBmbGFncykge1xuICAgIG51bWJlciA9IHN0cmlwUGx1cyhudW1iZXIpO1xuICAgIGNvbmZpcm0oYEJ1eWluZyAke251bWJlcn0uIFRoaXMgb3BlcmF0aW9uIHdpbGwgY2hhcmdlIHlvdXIgYWNjb3VudC5gLCB0aGlzLnJlc3BvbnNlLmVtaXR0ZXIsIGZsYWdzLCAoKSA9PiB7XG4gICAgICB0aGlzLmdldENvdW50cnlDb2RlKG51bWJlciwgZmxhZ3MsIChjb3VudHJ5X2NvZGUpID0+IHtcbiAgICAgICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5udW1iZXIuYnV5KGNvdW50cnlfY29kZSwgbnVtYmVyLCB0aGlzLnJlc3BvbnNlLm51bWJlckJ1eUZyb21OdW1iZXIobnVtYmVyKS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgbnVtYmVyQnV5RnJvbVNlYXJjaChjb3VudHJ5X2NvZGUsIHBhdHRlcm4sIGZsYWdzKSB7XG4gICAgbGV0IG9wdGlvbnMgPSB7IGZlYXR1cmVzOiBbJ1ZPSUNFJ10gfTtcblxuICAgIGlmIChwYXR0ZXJuKSB7XG4gICAgICBvcHRpb25zLnBhdHRlcm4gPSBwYXR0ZXJuO1xuICAgICAgb3B0aW9ucy5zZWFyY2hfcGF0dGVybiA9IDE7XG4gICAgICBpZiAocGF0dGVyblswXSA9PT0gJyonKSBvcHRpb25zLnNlYXJjaF9wYXR0ZXJuID0gMjtcbiAgICAgIGlmIChwYXR0ZXJuLnNsaWNlKC0xKSA9PT0gJyonKSBvcHRpb25zLnNlYXJjaF9wYXR0ZXJuID0gMDtcbiAgICB9XG5cbiAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLm51bWJlci5zZWFyY2goY291bnRyeV9jb2RlLCBvcHRpb25zLCB0aGlzLnJlc3BvbnNlLm51bWJlckJ1eUZyb21QYXR0ZXJuKChudW1iZXIpID0+IHtcbiAgICAgIHRoaXMubnVtYmVyQnV5RnJvbU51bWJlcihudW1iZXIsIGZsYWdzKTtcbiAgICB9KSk7XG4gIH1cblxuICBudW1iZXJDYW5jZWwobnVtYmVyLCBmbGFncykge1xuICAgIGNvbmZpcm0oJ1RoaXMgb3BlcmF0aW9uIGNhbiBub3QgYmUgcmV2ZXJzZWQuJywgdGhpcy5yZXNwb25zZS5lbWl0dGVyLCBmbGFncywgKCkgPT4ge1xuICAgICAgdGhpcy5nZXRDb3VudHJ5Q29kZShudW1iZXIsIGZsYWdzLCAoY291bnRyeV9jb2RlKSA9PiB7XG4gICAgICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkubnVtYmVyLmNhbmNlbChjb3VudHJ5X2NvZGUsIG51bWJlciwgdGhpcy5yZXNwb25zZS5udW1iZXJDYW5jZWwobnVtYmVyKS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQXBwbGljYXRpb25zXG5cbiAgYXBwbGljYXRpb25zTGlzdChmbGFncykge1xuICAgIGxldCBvcHRpb25zID0geyBwYWdlX3NpemU6IDEwMCB9O1xuICAgIGlmIChmbGFncy5wYWdlKSB7IG9wdGlvbnMuaW5kZXggPSBmbGFncy5wYWdlOyB9XG4gICAgaWYgKGZsYWdzLnNpemUpIHsgb3B0aW9ucy5wYWdlX3NpemUgPSBmbGFncy5zaXplOyB9XG5cbiAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLmFwcC5nZXQob3B0aW9ucywgdGhpcy5yZXNwb25zZS5hcHBsaWNhdGlvbnNMaXN0KGZsYWdzKS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIGFwcGxpY2F0aW9uQ3JlYXRlKG5hbWUsIGFuc3dlcl91cmwsIGV2ZW50X3VybCwgZmxhZ3MpIHtcbiAgICBsZXQgb3B0aW9ucyA9IHt9O1xuICAgIGlmIChmbGFncy5hbnN3ZXJfbWV0aG9kKSB7IG9wdGlvbnMuYW5zd2VyX21ldGhvZCA9IGZsYWdzLmFuc3dlcl9tZXRob2Q7IH1cbiAgICBpZiAoZmxhZ3MuZXZlbnRfbWV0aG9kKSB7IG9wdGlvbnMuZXZlbnRfbWV0aG9kID0gZmxhZ3MuZXZlbnRfbWV0aG9kOyB9XG5cbiAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLmFwcC5jcmVhdGUobmFtZSwgZmxhZ3MudHlwZSwgYW5zd2VyX3VybCwgZXZlbnRfdXJsLCBvcHRpb25zLCB0aGlzLnJlc3BvbnNlLmFwcGxpY2F0aW9uQ3JlYXRlKGZsYWdzKSk7XG4gIH1cblxuICBhcHBsaWNhdGlvblNob3coYXBwX2lkKSB7XG4gICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5hcHAuZ2V0KGFwcF9pZCwgdGhpcy5yZXNwb25zZS5hcHBsaWNhdGlvblNob3cuYmluZCh0aGlzLnJlc3BvbnNlKSk7XG4gIH1cblxuICBhcHBsaWNhdGlvblVwZGF0ZShhcHBfaWQsIG5hbWUsIGFuc3dlcl91cmwsIGV2ZW50X3VybCwgZmxhZ3MpIHtcbiAgICBsZXQgb3B0aW9ucyA9IHt9O1xuICAgIGlmIChmbGFncy5hbnN3ZXJfbWV0aG9kKSB7IG9wdGlvbnMuYW5zd2VyX21ldGhvZCA9IGZsYWdzLmFuc3dlcl9tZXRob2Q7IH1cbiAgICBpZiAoZmxhZ3MuZXZlbnRfbWV0aG9kKSB7IG9wdGlvbnMuZXZlbnRfbWV0aG9kID0gZmxhZ3MuZXZlbnRfbWV0aG9kOyB9XG5cbiAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLmFwcC51cGRhdGUoYXBwX2lkLCBuYW1lLCBmbGFncy50eXBlLCBhbnN3ZXJfdXJsLCBldmVudF91cmwsIG9wdGlvbnMsIHRoaXMucmVzcG9uc2UuYXBwbGljYXRpb25VcGRhdGUuYmluZCh0aGlzLnJlc3BvbnNlKSk7XG4gIH1cblxuICBhcHBsaWNhdGlvbkRlbGV0ZShhcHBfaWQsIGZsYWdzKSB7XG4gICAgcmV0dXJuIGNvbmZpcm0oJ1RoaXMgb3BlcmF0aW9uIGNhbiBub3QgYmUgcmV2ZXJzZWQuJywgdGhpcy5yZXNwb25zZS5lbWl0dGVyLCBmbGFncywgKCkgPT4ge1xuICAgICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5hcHAuZGVsZXRlKGFwcF9pZCwgdGhpcy5yZXNwb25zZS5hcHBsaWNhdGlvbkRlbGV0ZS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFwcGxpY2F0aW9uTnVtYmVycyhhcHBfaWQsIGZsYWdzKSB7XG4gICAgbGV0IG9wdGlvbnMgPSB7fTtcbiAgICBpZiAoZmxhZ3MucGFnZSkgeyBvcHRpb25zLmluZGV4ID0gZmxhZ3MucGFnZTsgfVxuICAgIGlmIChmbGFncy5zaXplKSB7IG9wdGlvbnMuc2l6ZSA9IGZsYWdzLnNpemU7IH1cblxuICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkubnVtYmVyLmdldChvcHRpb25zLCB0aGlzLnJlc3BvbnNlLmFwcGxpY2F0aW9uTnVtYmVycyhhcHBfaWQsIGZsYWdzKS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIC8vIGxpbmtzXG5cbiAgbGlua0FwcChudW1iZXIsIGFwcF9pZCwgZmxhZ3MpIHtcbiAgICB0aGlzLl9saW5rKG51bWJlciwgZmxhZ3MsIG51bGwsICdhcHAnLCBhcHBfaWQpO1xuICB9XG5cbiAgbGlua1NtcyhudW1iZXIsIGNhbGxiYWNrX3VybCwgZmxhZ3MpIHtcbiAgICB0aGlzLl9saW5rKG51bWJlciwgZmxhZ3MsIGNhbGxiYWNrX3VybCwgJ3NtcycsIG51bGwpO1xuICB9XG5cbiAgbGlua1RlbChudW1iZXIsIG90aGVyX251bWJlciwgZmxhZ3MpIHtcbiAgICB0aGlzLl9saW5rKG51bWJlciwgZmxhZ3MsIG51bGwsICd0ZWwnLCBvdGhlcl9udW1iZXIsIGZsYWdzLnZvaWNlX3N0YXR1c19jYWxsYmFjayk7XG4gIH1cblxuICBsaW5rU2lwKG51bWJlciwgc2lwX3VyaSwgZmxhZ3MpIHtcbiAgICB0aGlzLl9saW5rKG51bWJlciwgZmxhZ3MsIG51bGwsICdzaXAnLCBzaXBfdXJpLCBmbGFncy52b2ljZV9zdGF0dXNfY2FsbGJhY2spO1xuICB9XG5cbiAgbGlua1Z4bWwobnVtYmVyLCBjYWxiYWNrX3VybCwgZmxhZ3MpIHtcbiAgICB0aGlzLl9saW5rKG51bWJlciwgZmxhZ3MsIG51bGwsICd2eG1sJywgY2FsYmFja191cmwsIGZsYWdzLnZvaWNlX3N0YXR1c19jYWxsYmFjayk7XG4gIH1cblxuICB1bmxpbmtBcHAobnVtYmVyLCBmbGFncykge1xuICAgIHRoaXMuX2xpbmsobnVtYmVyLCBmbGFncywgbnVsbCwgJ2FwcCcpO1xuICB9XG5cbiAgdW5saW5rU21zKG51bWJlciwgZmxhZ3MpIHtcbiAgICB0aGlzLl9saW5rKG51bWJlciwgZmxhZ3MsICcnLCAnc21zJyk7XG4gIH1cblxuICB1bmxpbmtUZWwobnVtYmVyLCBmbGFncykge1xuICAgIHRoaXMuX2xpbmsobnVtYmVyLCBmbGFncywgbnVsbCwgJ3RlbCcpO1xuICB9XG5cbiAgdW5saW5rU2lwKG51bWJlciwgZmxhZ3MpIHtcbiAgICB0aGlzLl9saW5rKG51bWJlciwgZmxhZ3MsIG51bGwsICdzaXAnKTtcbiAgfVxuXG4gIHVubGlua1Z4bWwobnVtYmVyLCBmbGFncykge1xuICAgIHRoaXMuX2xpbmsobnVtYmVyLCBmbGFncywgbnVsbCwgJ3Z4bWwnKTtcbiAgfVxuXG4gIG51bWJlclVwZGF0ZShudW1iZXIsIGZsYWdzKSB7XG4gICAgbnVtYmVyID0gc3RyaXBQbHVzKG51bWJlcik7XG4gICAgdGhpcy5nZXRDb3VudHJ5Q29kZShudW1iZXIsIGZsYWdzLCAoY291bnRyeV9jb2RlKSA9PiB7XG4gICAgICBsZXQgb3B0aW9ucyA9IHt9O1xuICAgICAgaWYgKGZsYWdzLm1vX2h0dHBfdXJsKSBvcHRpb25zLm1vSHR0cFVybCA9IGZsYWdzLm1vX2h0dHBfdXJsO1xuICAgICAgaWYgKGZsYWdzLnZvaWNlX2NhbGxiYWNrX3R5cGUpIG9wdGlvbnMudm9pY2VDYWxsYmFja1R5cGUgPSBmbGFncy52b2ljZV9jYWxsYmFja190eXBlO1xuICAgICAgaWYgKGZsYWdzLnZvaWNlX2NhbGxiYWNrX3ZhbHVlKSBvcHRpb25zLnZvaWNlQ2FsbGJhY2tWYWx1ZSA9IGZsYWdzLnZvaWNlX2NhbGxiYWNrX3ZhbHVlO1xuICAgICAgaWYgKGZsYWdzLnZvaWNlX3N0YXR1c19jYWxsYmFjaykgb3B0aW9ucy52b2ljZVN0YXR1c0NhbGxiYWNrID0gZmxhZ3Mudm9pY2Vfc3RhdHVzX2NhbGxiYWNrO1xuICAgICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5udW1iZXIudXBkYXRlKGNvdW50cnlfY29kZSwgbnVtYmVyLCBvcHRpb25zLCB0aGlzLnJlc3BvbnNlLm51bWJlclVwZGF0ZS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICB9KTtcbiAgfVxuXG4gIF9saW5rKG51bWJlciwgZmxhZ3MsIG1vX2h0dHBfdXJsLCB2b2ljZV9jYWxsYmFja190eXBlLCB2b2ljZV9jYWxsYmFja192YWx1ZSwgdm9pY2Vfc3RhdHVzX2NhbGxiYWNrKSB7XG4gICAgaWYgKGZsYWdzID09IG51bGwpIHsgZmxhZ3MgPSB7fTsgfVxuICAgIG51bWJlciA9IHN0cmlwUGx1cyhudW1iZXIpO1xuICAgIHRoaXMuZ2V0Q291bnRyeUNvZGUobnVtYmVyLCBmbGFncywgKGNvdW50cnlfY29kZSkgPT4ge1xuICAgICAgbGV0IG9wdGlvbnMgPSB7fTtcblxuICAgICAgaWYgKHZvaWNlX2NhbGxiYWNrX3R5cGUgPT0gJ3NtcycpIHtcbiAgICAgICAgb3B0aW9ucy5tb0h0dHBVcmwgPSBtb19odHRwX3VybDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9wdGlvbnMudm9pY2VDYWxsYmFja1R5cGUgPSB2b2ljZV9jYWxsYmFja190eXBlO1xuICAgICAgICBpZiAodm9pY2VfY2FsbGJhY2tfdmFsdWUpIG9wdGlvbnMudm9pY2VDYWxsYmFja1ZhbHVlID0gdm9pY2VfY2FsbGJhY2tfdmFsdWU7XG4gICAgICAgIGlmICh2b2ljZV9zdGF0dXNfY2FsbGJhY2spIG9wdGlvbnMudm9pY2VTdGF0dXNDYWxsYmFjayA9IHZvaWNlX3N0YXR1c19jYWxsYmFjaztcbiAgICAgIH1cblxuICAgICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5udW1iZXIudXBkYXRlKGNvdW50cnlfY29kZSwgbnVtYmVyLCBvcHRpb25zLCB0aGlzLnJlc3BvbnNlLm51bWJlclVwZGF0ZS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEluc2lnaHRcblxuICBpbnNpZ2h0QmFzaWMobnVtYmVyKSB7XG4gICAgbnVtYmVyID0gc3RyaXBQbHVzKG51bWJlcik7XG4gICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5udW1iZXJJbnNpZ2h0LmdldCh7IGxldmVsOiAnYmFzaWMnLCBudW1iZXI6IG51bWJlciB9LCB0aGlzLnJlc3BvbnNlLmluc2lnaHRCYXNpYy5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIGluc2lnaHRTdGFuZGFyZChudW1iZXIsIGZsYWdzKSB7XG4gICAgbnVtYmVyID0gc3RyaXBQbHVzKG51bWJlcik7XG4gICAgY29uZmlybSgnVGhpcyBvcGVyYXRpb24gd2lsbCBjaGFyZ2UgeW91ciBhY2NvdW50LicsIHRoaXMucmVzcG9uc2UuZW1pdHRlciwgZmxhZ3MsICgpID0+IHtcbiAgICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkubnVtYmVySW5zaWdodC5nZXQoeyBsZXZlbDogJ3N0YW5kYXJkJywgbnVtYmVyOiBudW1iZXIgfSwgdGhpcy5yZXNwb25zZS5pbnNpZ2h0U3RhbmRhcmQuYmluZCh0aGlzLnJlc3BvbnNlKSk7XG4gICAgfSk7XG4gIH1cblxuICBpbnNpZ2h0QWR2YW5jZWQobnVtYmVyLCBmbGFncykge1xuICAgIG51bWJlciA9IHN0cmlwUGx1cyhudW1iZXIpO1xuICAgIGNvbmZpcm0oJ1RoaXMgb3BlcmF0aW9uIHdpbGwgY2hhcmdlIHlvdXIgYWNjb3VudC4nLCB0aGlzLnJlc3BvbnNlLmVtaXR0ZXIsIGZsYWdzLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLm51bWJlckluc2lnaHQuZ2V0KHsgbGV2ZWw6ICdhZHZhbmNlZFN5bmMnLCBudW1iZXI6IG51bWJlciB9LCB0aGlzLnJlc3BvbnNlLmluc2lnaHRTdGFuZGFyZC5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHNlbmRpbmcgbWVzc2FnZXNcblxuICBzZW5kU21zKHRvLCB0ZXh0LCBmbGFncykge1xuICAgIGNvbmZpcm0oJ1RoaXMgb3BlcmF0aW9uIHdpbGwgY2hhcmdlIHlvdXIgYWNjb3VudC4nLCB0aGlzLnJlc3BvbnNlLmVtaXR0ZXIsIGZsYWdzLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLm1lc3NhZ2Uuc2VuZFNtcyhmbGFncy5mcm9tLCB0bywgdGV4dC5qb2luKCcgJyksIHRoaXMucmVzcG9uc2Uuc2VuZFNtcy5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdlbmVyYXRlSnd0KHByaXZhdGVLZXksIGNsYWltcywgZmxhZ3MpIHtcbiAgICBsZXQgdG9rZW4gPSBudWxsO1xuICAgIGxldCBlcnJvciA9IG51bGw7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgZnVsbENsYWltcyA9IHt9O1xuICAgICAgaWYgKGZsYWdzLmFwcF9pZCkge1xuICAgICAgICBmdWxsQ2xhaW1zWydhcHBsaWNhdGlvbl9pZCddID0gZmxhZ3MuYXBwX2lkO1xuICAgICAgfVxuXG4gICAgICBjbGFpbXMuZm9yRWFjaCgoY2xhaW0pID0+IHtcbiAgICAgICAgbGV0IG5hbWVWYWx1ZSA9IGNsYWltLnNwbGl0KCc9Jyk7XG4gICAgICAgIGlmIChuYW1lVmFsdWUubGVuZ3RoICE9PSAyKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBbGwgY2xhaW1zIG11c3QgYmUgaW4gdGhlIGZvcm0gYG5hbWU9dmFsdWVgLiBHb3Q6ICcgKyBuYW1lVmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFVzaW5nIEpTT04ucGFyc2UgdG8gY2FzdCAnZXhwJyB0byBudW1iZXJcbiAgICAgICAgaWYgKG5hbWVWYWx1ZVswXSA9PT0gJ2FjbCcgfHwgbmFtZVZhbHVlWzBdID09PSAnZXhwJykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmdWxsQ2xhaW1zW25hbWVWYWx1ZVswXV0gPSBKU09OLnBhcnNlKG5hbWVWYWx1ZVsxXSk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZnVsbENsYWltc1tuYW1lVmFsdWVbMF1dID0gbmFtZVZhbHVlWzFdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmdWxsQ2xhaW1zW25hbWVWYWx1ZVswXV0gPSBuYW1lVmFsdWVbMV07XG4gICAgICAgIH1cblxuICAgICAgfSk7XG5cbiAgICAgIHRva2VuID0gdGhpcy5jbGllbnQuZGVmaW5pdGlvbigpLmdlbmVyYXRlSnd0KHByaXZhdGVLZXksIGZ1bGxDbGFpbXMpO1xuICAgIH1cbiAgICBjYXRjaCAoZXgpIHtcbiAgICAgIGVycm9yID0gZXg7XG4gICAgfVxuICAgIHRoaXMucmVzcG9uc2UuZ2VuZXJhdGVKd3QoZXJyb3IsIHRva2VuKTtcbiAgfVxuXG4gIGdldENvdW50cnlDb2RlKG51bWJlciwgZmxhZ3MsIGNhbGxiYWNrKSB7XG4gICAgaWYgKGZsYWdzLmNvdW50cnlfY29kZSkge1xuICAgICAgY2FsbGJhY2soZmxhZ3MuY291bnRyeV9jb2RlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLm51bWJlckluc2lnaHQuZ2V0KHsgbGV2ZWw6ICdiYXNpYycsIG51bWJlcjogbnVtYmVyIH0sIHRoaXMucmVzcG9uc2UubnVtYmVySW5zaWdodCgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgY2FsbGJhY2socmVzcG9uc2UuY291bnRyeV9jb2RlKTtcbiAgICAgIH0pKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmVxdWVzdDtcblxuLy8gcHJpdmF0ZSBtZXRob2RzXG5cbmxldCBjb25maXJtID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGVtaXR0ZXIsIGZsYWdzLCBjYWxsYmFjaykge1xuICBpZiAoZmxhZ3MuY29uZmlybSkge1xuICAgIGNhbGxiYWNrKCk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IGNsaSA9IHJlYWRsaW5lLmNyZWF0ZUludGVyZmFjZShwcm9jZXNzLnN0ZGluLCBwcm9jZXNzLnN0ZG91dCk7XG4gICAgY2xpLnF1ZXN0aW9uKG1lc3NhZ2UgKyAnXFxuXFxuUGxlYXNlIHR5cGUgXCJjb25maXJtXCIgdG8gY29udGludWU6ICcsIChhbnN3ZXIpID0+IHtcbiAgICAgIGlmIChhbnN3ZXIudG9TdHJpbmcoKS50cmltKCkgPT0gJ2NvbmZpcm0nKSB7XG4gICAgICAgIGVtaXR0ZXIubG9nKCcgJyk7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICB9XG5cbiAgICAgIGNsaS5jbG9zZSgpO1xuICAgICAgcHJvY2Vzcy5zdGRpbi5kZXN0cm95KCk7XG4gICAgfSk7XG4gIH1cbn07XG5cbmxldCBzdHJpcFBsdXMgPSBmdW5jdGlvbiAobnVtYmVyKSB7XG4gIGlmICghbnVtYmVyKSB7IHJldHVybiBudW1iZXI7IH1cbiAgd2hpbGUgKG51bWJlci5jaGFyQXQoMCkgPT09ICcrJykge1xuICAgIG51bWJlciA9IG51bWJlci5zdWJzdHIoMSk7XG4gIH1cbiAgcmV0dXJuIG51bWJlcjtcbn07XG5cbiJdfQ==