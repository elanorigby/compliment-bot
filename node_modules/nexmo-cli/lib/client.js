'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _nexmo = require('nexmo');

var _nexmo2 = _interopRequireDefault(_nexmo);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Client = function () {
  function Client(config, emitter) {
    _classCallCheck(this, Client);

    this.emitter = emitter;
    this.config = config;
  }

  _createClass(Client, [{
    key: 'instance',
    value: function instance() {
      var nexmo = initialize(this.config, this.emitter);
      return nexmo;
    }
  }, {
    key: 'definition',
    value: function definition() {
      return _nexmo2.default;
    }
  }, {
    key: 'instanceWith',
    value: function instanceWith(key, secret) {
      return new _nexmo2.default({ apiKey: key, apiSecret: secret });
    }
  }]);

  return Client;
}();

exports.default = Client;

// private methods

var initialize = function initialize(config, emitter) {
  var nexmo = null;
  var packageDetails = require(__dirname + '/../package.json');

  try {
    var credentials = config.read().credentials;
    nexmo = new _nexmo2.default({
      apiKey: credentials.api_key,
      apiSecret: credentials.api_secret
    }, {
      debug: emitter.debugging,
      appendToUserAgent: 'nexmo-cli/' + packageDetails.version.replace('v', '')
    });
  } catch (e) {
    if (e instanceof TypeError) {
      emitter.error('Could not initialize Nexmo library. Please run \'nexmo setup\' to setup the CLI correctly. (' + e.message + ')');
    } else {
      emitter.error('Could not read credentials. Please run \'nexmo setup\' to setup the CLI. (' + e.message + ')');
    }
  }
  return nexmo;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jbGllbnQuanMiXSwibmFtZXMiOlsiQ2xpZW50IiwiY29uZmlnIiwiZW1pdHRlciIsIm5leG1vIiwiaW5pdGlhbGl6ZSIsIk5leG1vIiwia2V5Iiwic2VjcmV0IiwiYXBpS2V5IiwiYXBpU2VjcmV0IiwicGFja2FnZURldGFpbHMiLCJyZXF1aXJlIiwiX19kaXJuYW1lIiwiY3JlZGVudGlhbHMiLCJyZWFkIiwiYXBpX2tleSIsImFwaV9zZWNyZXQiLCJkZWJ1ZyIsImRlYnVnZ2luZyIsImFwcGVuZFRvVXNlckFnZW50IiwidmVyc2lvbiIsInJlcGxhY2UiLCJlIiwiVHlwZUVycm9yIiwiZXJyb3IiLCJtZXNzYWdlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7Ozs7OztJQUVNQSxNO0FBQ0osa0JBQVlDLE1BQVosRUFBb0JDLE9BQXBCLEVBQTZCO0FBQUE7O0FBQzNCLFNBQUtBLE9BQUwsR0FBZUEsT0FBZjtBQUNBLFNBQUtELE1BQUwsR0FBY0EsTUFBZDtBQUNEOzs7OytCQUVVO0FBQ1QsVUFBSUUsUUFBUUMsV0FBVyxLQUFLSCxNQUFoQixFQUF3QixLQUFLQyxPQUE3QixDQUFaO0FBQ0EsYUFBT0MsS0FBUDtBQUNEOzs7aUNBRVk7QUFDWCxhQUFPRSxlQUFQO0FBQ0Q7OztpQ0FFWUMsRyxFQUFLQyxNLEVBQVE7QUFDeEIsYUFBTyxJQUFJRixlQUFKLENBQVUsRUFBQ0csUUFBUUYsR0FBVCxFQUFjRyxXQUFXRixNQUF6QixFQUFWLENBQVA7QUFDRDs7Ozs7O2tCQUdZUCxNOztBQUVmOztBQUVBLElBQUlJLGFBQWEsU0FBYkEsVUFBYSxDQUFTSCxNQUFULEVBQWlCQyxPQUFqQixFQUEwQjtBQUN6QyxNQUFJQyxRQUFRLElBQVo7QUFDQSxNQUFJTyxpQkFBaUJDLFFBQVdDLFNBQVgsc0JBQXJCOztBQUVBLE1BQUk7QUFDRixRQUFJQyxjQUFjWixPQUFPYSxJQUFQLEdBQWNELFdBQWhDO0FBQ0FWLFlBQVEsSUFBSUUsZUFBSixDQUNOO0FBQ0VHLGNBQVFLLFlBQVlFLE9BRHRCO0FBRUVOLGlCQUFXSSxZQUFZRztBQUZ6QixLQURNLEVBS047QUFDRUMsYUFBT2YsUUFBUWdCLFNBRGpCO0FBRUVDLHdDQUFnQ1QsZUFBZVUsT0FBZixDQUF1QkMsT0FBdkIsQ0FBK0IsR0FBL0IsRUFBb0MsRUFBcEM7QUFGbEMsS0FMTSxDQUFSO0FBVUQsR0FaRCxDQVlFLE9BQU1DLENBQU4sRUFBUztBQUNULFFBQUlBLGFBQWFDLFNBQWpCLEVBQTRCO0FBQzFCckIsY0FBUXNCLEtBQVIsa0dBQTJHRixFQUFFRyxPQUE3RztBQUNELEtBRkQsTUFFTztBQUNMdkIsY0FBUXNCLEtBQVIsZ0ZBQXlGRixFQUFFRyxPQUEzRjtBQUNEO0FBQ0Y7QUFDRCxTQUFPdEIsS0FBUDtBQUNELENBeEJEIiwiZmlsZSI6ImNsaWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBOZXhtbyBmcm9tICduZXhtbyc7XG5cbmNsYXNzIENsaWVudCB7XG4gIGNvbnN0cnVjdG9yKGNvbmZpZywgZW1pdHRlcikge1xuICAgIHRoaXMuZW1pdHRlciA9IGVtaXR0ZXI7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gIH1cblxuICBpbnN0YW5jZSgpIHtcbiAgICBsZXQgbmV4bW8gPSBpbml0aWFsaXplKHRoaXMuY29uZmlnLCB0aGlzLmVtaXR0ZXIpO1xuICAgIHJldHVybiBuZXhtbztcbiAgfVxuXG4gIGRlZmluaXRpb24oKSB7XG4gICAgcmV0dXJuIE5leG1vO1xuICB9XG5cbiAgaW5zdGFuY2VXaXRoKGtleSwgc2VjcmV0KSB7XG4gICAgcmV0dXJuIG5ldyBOZXhtbyh7YXBpS2V5OiBrZXksIGFwaVNlY3JldDogc2VjcmV0fSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ2xpZW50O1xuXG4vLyBwcml2YXRlIG1ldGhvZHNcblxubGV0IGluaXRpYWxpemUgPSBmdW5jdGlvbihjb25maWcsIGVtaXR0ZXIpIHtcbiAgbGV0IG5leG1vID0gbnVsbDtcbiAgbGV0IHBhY2thZ2VEZXRhaWxzID0gcmVxdWlyZShgJHtfX2Rpcm5hbWV9Ly4uL3BhY2thZ2UuanNvbmApO1xuXG4gIHRyeSB7XG4gICAgbGV0IGNyZWRlbnRpYWxzID0gY29uZmlnLnJlYWQoKS5jcmVkZW50aWFscztcbiAgICBuZXhtbyA9IG5ldyBOZXhtbyhcbiAgICAgIHtcbiAgICAgICAgYXBpS2V5OiBjcmVkZW50aWFscy5hcGlfa2V5LFxuICAgICAgICBhcGlTZWNyZXQ6IGNyZWRlbnRpYWxzLmFwaV9zZWNyZXRcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGRlYnVnOiBlbWl0dGVyLmRlYnVnZ2luZyxcbiAgICAgICAgYXBwZW5kVG9Vc2VyQWdlbnQ6IGBuZXhtby1jbGkvJHtwYWNrYWdlRGV0YWlscy52ZXJzaW9uLnJlcGxhY2UoJ3YnLCAnJyl9YFxuICAgICAgfVxuICAgICk7XG4gIH0gY2F0Y2goZSkge1xuICAgIGlmIChlIGluc3RhbmNlb2YgVHlwZUVycm9yKSB7XG4gICAgICBlbWl0dGVyLmVycm9yKGBDb3VsZCBub3QgaW5pdGlhbGl6ZSBOZXhtbyBsaWJyYXJ5LiBQbGVhc2UgcnVuICduZXhtbyBzZXR1cCcgdG8gc2V0dXAgdGhlIENMSSBjb3JyZWN0bHkuICgke2UubWVzc2FnZX0pYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVtaXR0ZXIuZXJyb3IoYENvdWxkIG5vdCByZWFkIGNyZWRlbnRpYWxzLiBQbGVhc2UgcnVuICduZXhtbyBzZXR1cCcgdG8gc2V0dXAgdGhlIENMSS4gKCR7ZS5tZXNzYWdlfSlgKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG5leG1vO1xufTtcbiJdfQ==