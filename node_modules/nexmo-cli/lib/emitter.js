'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Emitter = function () {
  function Emitter() {
    _classCallCheck(this, Emitter);

    this.silenced = false;
    this.amplified = false;
    this.debugging = false;
  }

  _createClass(Emitter, [{
    key: 'quiet',
    value: function quiet() {
      var silenced = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

      this.silenced = silenced;
    }
  }, {
    key: 'verbose',
    value: function verbose() {
      var amplified = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

      this.amplified = amplified;
    }
  }, {
    key: 'debug',
    value: function debug() {
      var debugging = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

      this.debugging = debugging;
    }
  }, {
    key: 'log',
    value: function log(message, amplified_message) {
      if (this.amplified && amplified_message) message = amplified_message;
      if (!this.silenced && message) console.log(message); // eslint-disable-line no-console
    }
  }, {
    key: 'warn',
    value: function warn(message) {
      if (!this.silenced) console.warn(message); // eslint-disable-line no-console
    }
  }, {
    key: 'error',
    value: function error(message) {
      console.error(message); // eslint-disable-line no-console
      process.exit(1);
    }
  }, {
    key: 'debugger',
    value: function _debugger(message) {
      if (this.debugging) {
        console.log(message);
      } // eslint-disable-line no-console
    }
  }, {
    key: 'table',
    value: function table(data, regular_keys, verbose_keys) {
      var _this = this;

      var keys = this.amplified ? verbose_keys : regular_keys;
      var records = mapRecords(data, keys);
      if (this.amplified) {
        records.unshift(keys);
      }
      var lengths = valueLengths(records);

      records.forEach(function (record, row) {
        var message = formatMessage(record, lengths);
        _this.log(message);
        if (row == 0 && _this.amplified) _this.log(right('', message.length, '-'));
      });
    }
  }, {
    key: 'list',
    value: function list(message, verbose_data) {
      if (this.amplified || !message) {
        var _message = formatList(verbose_data);
        this.log(_message);
      } else {
        this.log(message);
      }
    }
  }, {
    key: 'pagination',
    value: function pagination(flags, data) {
      var page = parseInt(flags.page || 1);
      var size = parseInt(flags.size || 100);
      var total = data.count;
      var start = size * (page - 1) + 1;
      var end = Math.min(start + size - 1, total);

      if (this.amplified) this.log('Item ' + start + '-' + end + ' of ' + total + '\n');
    }
  }]);

  return Emitter;
}();

exports.default = Emitter;


var right = function right() {
  var string = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
  var size = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ' ';

  if (string.length >= size) {
    return string;
  }

  var max = size - string.length;
  for (var i = 0; i < max; i++) {
    string += padding;
  }

  return string;
};

var mapRecords = function mapRecords(records, keys) {
  return records.map(function (record) {
    var mappedRecord = keys.map(function (key) {
      return '' + record[key];
    });
    return mappedRecord;
  });
};

var valueLengths = function valueLengths(records) {
  var lengths = [];
  records.forEach(function (record) {
    record.forEach(function (value, index) {
      lengths[index] = Math.max(lengths[index] || 0, value.length);
    });
  });
  return lengths;
};

var formatMessage = function formatMessage(record, lengths) {
  return record.reduce(function (previous, current, index) {
    if (index == 1) {
      previous = right(previous, lengths[index - 1]);
    }
    return previous + ' | ' + right(current, lengths[index]);
  });
};

var formatList = function formatList(data) {
  var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

  var message = '';
  for (var key in data) {
    var value = data[key];
    if ((typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object') {
      message += formatList(value, prefix + key + '.');
    } else {
      message += '[' + prefix + key + ']\n';
      message += data[key] + '\n\n';
    }
  }
  return message;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbWl0dGVyLmpzIl0sIm5hbWVzIjpbIkVtaXR0ZXIiLCJzaWxlbmNlZCIsImFtcGxpZmllZCIsImRlYnVnZ2luZyIsIm1lc3NhZ2UiLCJhbXBsaWZpZWRfbWVzc2FnZSIsImNvbnNvbGUiLCJsb2ciLCJ3YXJuIiwiZXJyb3IiLCJwcm9jZXNzIiwiZXhpdCIsImRhdGEiLCJyZWd1bGFyX2tleXMiLCJ2ZXJib3NlX2tleXMiLCJrZXlzIiwicmVjb3JkcyIsIm1hcFJlY29yZHMiLCJ1bnNoaWZ0IiwibGVuZ3RocyIsInZhbHVlTGVuZ3RocyIsImZvckVhY2giLCJyZWNvcmQiLCJyb3ciLCJmb3JtYXRNZXNzYWdlIiwicmlnaHQiLCJsZW5ndGgiLCJ2ZXJib3NlX2RhdGEiLCJmb3JtYXRMaXN0IiwiZmxhZ3MiLCJwYWdlIiwicGFyc2VJbnQiLCJzaXplIiwidG90YWwiLCJjb3VudCIsInN0YXJ0IiwiZW5kIiwiTWF0aCIsIm1pbiIsInN0cmluZyIsInBhZGRpbmciLCJtYXgiLCJpIiwibWFwIiwibWFwcGVkUmVjb3JkIiwia2V5IiwidmFsdWUiLCJpbmRleCIsInJlZHVjZSIsInByZXZpb3VzIiwiY3VycmVudCIsInByZWZpeCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0lBQU1BLE87QUFDSixxQkFBYztBQUFBOztBQUNaLFNBQUtDLFFBQUwsR0FBZ0IsS0FBaEI7QUFDQSxTQUFLQyxTQUFMLEdBQWlCLEtBQWpCO0FBQ0EsU0FBS0MsU0FBTCxHQUFpQixLQUFqQjtBQUNEOzs7OzRCQUVzQjtBQUFBLFVBQWpCRixRQUFpQix1RUFBTixJQUFNOztBQUNyQixXQUFLQSxRQUFMLEdBQWdCQSxRQUFoQjtBQUNEOzs7OEJBRXlCO0FBQUEsVUFBbEJDLFNBQWtCLHVFQUFOLElBQU07O0FBQ3hCLFdBQUtBLFNBQUwsR0FBaUJBLFNBQWpCO0FBQ0Q7Ozs0QkFFdUI7QUFBQSxVQUFsQkMsU0FBa0IsdUVBQU4sSUFBTTs7QUFDdEIsV0FBS0EsU0FBTCxHQUFp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R0FITSxDQUFQO0FBSUQsQ0FMRDs7QUFPQSxJQUFJbkIsYUFBYSxTQUFiQSxVQUFhLENBQVNoQixJQUFULEVBQTRCO0FBQUEsTUFBYnVDLE1BQWEsdUVBQUosRUFBSTs7QUFDM0MsTUFBSS9DLFVBQVUsRUFBZDtBQUNBLE9BQUssSUFBSXlDLEdBQVQsSUFBZ0JqQyxJQUFoQixFQUFzQjtBQUNwQixRQUFJa0MsUUFBUWxDLEtBQUtpQyxHQUFMLENBQVo7QUFDQSxRQUFJLFFBQU9DLEtBQVAseUNBQU9BLEtBQVAsT0FBa0IsUUFBdEIsRUFBZ0M7QUFDOUIxQyxpQkFBV3dCLFdBQVdrQixLQUFYLEVBQWtCSyxTQUFPTixHQUFQLEdBQVcsR0FBN0IsQ0FBWDtBQUNELEtBRkQsTUFFTztBQUNMekMsdUJBQWUrQyxNQUFmLEdBQXdCTixHQUF4QjtBQUNBekMsaUJBQWNRLEtBQUtpQyxHQUFMLENBQWQ7QUFDRDtBQUNGO0FBQ0QsU0FBT3pDLE9BQVA7QUFDRCxDQVpEIiwiZmlsZSI6ImVtaXR0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBFbWl0dGVyIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5zaWxlbmNlZCA9IGZhbHNlO1xuICAgIHRoaXMuYW1wbGlmaWVkID0gZmFsc2U7XG4gICAgdGhpcy5kZWJ1Z2dpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIHF1aWV0KHNpbGVuY2VkID0gdHJ1ZSkge1xuICAgIHRoaXMuc2lsZW5jZWQgPSBzaWxlbmNlZDtcbiAgfVxuXG4gIHZlcmJvc2UoYW1wbGlmaWVkID0gdHJ1ZSkge1xuICAgIHRoaXMuYW1wbGlmaWVkID0gYW1wbGlmaWVkO1xuICB9XG5cbiAgZGVidWcoZGVidWdnaW5nID0gdHJ1ZSkge1xuICAgIHRoaXMuZGVidWdnaW5nID0gZGVidWdnaW5nO1xuICB9XG5cbiAgbG9nKG1lc3NhZ2UsIGFtcGxpZmllZF9tZXNzYWdlKSB7XG4gICAgaWYgKHRoaXMuYW1wbGlmaWVkICYmIGFtcGxpZmllZF9tZXNzYWdlKSBtZXNzYWdlID0gYW1wbGlmaWVkX21lc3NhZ2U7XG4gICAgaWYgKCF0aGlzLnNpbGVuY2VkICYmIG1lc3NhZ2UpIGNvbnNvbGUubG9nKG1lc3NhZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGVcbiAgfVxuXG4gIHdhcm4obWVzc2FnZSkge1xuICAgIGlmICghdGhpcy5zaWxlbmNlZCkgY29uc29sZS53YXJuKG1lc3NhZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGVcbiAgfVxuXG4gIGVycm9yKG1lc3NhZ2UpIHtcbiAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGVcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cblxuICBkZWJ1Z2dlcihtZXNzYWdlKSB7XG4gICAgaWYgKHRoaXMuZGVidWdnaW5nKSB7IGNvbnNvbGUubG9nKG1lc3NhZ2UpOyB9IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZVxuICB9XG5cbiAgdGFibGUoZGF0YSwgcmVndWxhcl9rZXlzLCB2ZXJib3NlX2tleXMpIHtcbiAgICBsZXQga2V5cyA9IHRoaXMuYW1wbGlmaWVkID8gdmVyYm9zZV9rZXlzIDogcmVndWxhcl9rZXlzO1xuICAgIGxldCByZWNvcmRzID0gbWFwUmVjb3JkcyhkYXRhLCBrZXlzKTtcbiAgICBpZiAodGhpcy5hbXBsaWZpZWQpIHsgcmVjb3Jkcy51bnNoaWZ0KGtleXMpOyB9XG4gICAgbGV0IGxlbmd0aHMgPSB2YWx1ZUxlbmd0aHMocmVjb3Jkcyk7XG5cbiAgICByZWNvcmRzLmZvckVhY2goKHJlY29yZCwgcm93KSA9PiB7XG4gICAgICBsZXQgbWVzc2FnZSA9IGZvcm1hdE1lc3NhZ2UocmVjb3JkLCBsZW5ndGhzKTtcbiAgICAgIHRoaXMubG9nKG1lc3NhZ2UpO1xuICAgICAgaWYgKHJvdyA9PSAwICYmIHRoaXMuYW1wbGlmaWVkKSB0aGlzLmxvZyhyaWdodCgnJywgbWVzc2FnZS5sZW5ndGgsICctJykpO1xuICAgIH0pO1xuICB9XG5cbiAgbGlzdChtZXNzYWdlLCB2ZXJib3NlX2RhdGEpIHtcbiAgICBpZiAodGhpcy5hbXBsaWZpZWQgfHwgIW1lc3NhZ2UpIHtcbiAgICAgIGxldCBtZXNzYWdlID0gZm9ybWF0TGlzdCh2ZXJib3NlX2RhdGEpO1xuICAgICAgdGhpcy5sb2cobWVzc2FnZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubG9nKG1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIHBhZ2luYXRpb24oZmxhZ3MsIGRhdGEpIHtcbiAgICBjb25zdCBwYWdlICA9IHBhcnNlSW50KGZsYWdzLnBhZ2UgfHwgMSk7XG4gICAgY29uc3Qgc2l6ZSAgPSBwYXJzZUludChmbGFncy5zaXplIHx8IDEwMCk7XG4gICAgY29uc3QgdG90YWwgPSBkYXRhLmNvdW50O1xuICAgIGNvbnN0IHN0YXJ0ID0gc2l6ZSoocGFnZS0xKSArIDE7XG4gICAgY29uc3QgZW5kICAgPSBNYXRoLm1pbihzdGFydCArIHNpemUgLSAxLCB0b3RhbCk7XG5cbiAgICBpZiAodGhpcy5hbXBsaWZpZWQpIHRoaXMubG9nKGBJdGVtICR7c3RhcnR9LSR7ZW5kfSBvZiAke3RvdGFsfVxcbmApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEVtaXR0ZXI7XG5cbmxldCByaWdodCA9IGZ1bmN0aW9uKHN0cmluZyA9ICcnLCBzaXplID0gMCwgcGFkZGluZyA9ICcgJykge1xuICBpZiAoc3RyaW5nLmxlbmd0aCA+PSBzaXplKSB7IHJldHVybiBzdHJpbmc7IH1cblxuICB2YXIgbWF4ID0gc2l6ZSAtIHN0cmluZy5sZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbWF4OyBpKyspIHtcbiAgICBzdHJpbmcgKz0gcGFkZGluZztcbiAgfVxuXG4gIHJldHVybiBzdHJpbmc7XG59O1xuXG5sZXQgbWFwUmVjb3JkcyA9IGZ1bmN0aW9uKHJlY29yZHMsIGtleXMpIHtcbiAgcmV0dXJuIHJlY29yZHMubWFwKChyZWNvcmQpID0+IHtcbiAgICBsZXQgbWFwcGVkUmVjb3JkID0ga2V5cy5tYXAoKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIGAke3JlY29yZFtrZXldfWA7XG4gICAgfSk7XG4gICAgcmV0dXJuIG1hcHBlZFJlY29yZDtcbiAgfSk7XG59O1xuXG5sZXQgdmFsdWVMZW5ndGhzID0gZnVuY3Rpb24ocmVjb3Jkcykge1xuICBsZXQgbGVuZ3RocyA9IFtdO1xuICByZWNvcmRzLmZvckVhY2goKHJlY29yZCkgPT4ge1xuICAgIHJlY29yZC5mb3JFYWNoKCh2YWx1ZSwgaW5kZXgpID0+IHtcbiAgICAgIGxlbmd0aHNbaW5kZXhdID0gTWF0aC5tYXgobGVuZ3Roc1tpbmRleF0gfHwgMCwgdmFsdWUubGVuZ3RoKTtcbiAgICB9KTtcbiAgfSk7XG4gIHJldHVybiBsZW5ndGhzO1xufTtcblxubGV0IGZvcm1hdE1lc3NhZ2UgPSBmdW5jdGlvbihyZWNvcmQsIGxlbmd0aHMpIHtcbiAgcmV0dXJuIHJlY29yZC5yZWR1Y2UoKHByZXZpb3VzLCBjdXJyZW50LCBpbmRleCkgPT4ge1xuICAgIGlmIChpbmRleCA9PSAxKSB7IHByZXZpb3VzID0gcmlnaHQocHJldmlvdXMsIGxlbmd0aHNbaW5kZXgtMV0pOyB9XG4gICAgcmV0dXJuIGAke3ByZXZpb3VzfSB8ICR7cmlnaHQoY3VycmVudCwgbGVuZ3Roc1tpbmRleF0pfWA7XG4gIH0pO1xufTtcblxubGV0IGZvcm1hdExpc3QgPSBmdW5jdGlvbihkYXRhLCBwcmVmaXggPSAnJykge1xuICBsZXQgbWVzc2FnZSA9ICcnO1xuICBmb3IgKGxldCBrZXkgaW4gZGF0YSkge1xuICAgIGxldCB2YWx1ZSA9IGRhdGFba2V5XTtcbiAgICBpZiAodHlwZW9mKHZhbHVlKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIG1lc3NhZ2UgKz0gZm9ybWF0TGlzdCh2YWx1ZSwgcHJlZml4K2tleSsnLicpO1xuICAgIH0gZWxzZSB7XG4gICAgICBtZXNzYWdlICs9IGBbJHtwcmVmaXh9JHtrZXl9XVxcbmA7XG4gICAgICBtZXNzYWdlICs9IGAke2RhdGFba2V5XX1cXG5cXG5gO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbWVzc2FnZTtcbn07XG4iXX0=